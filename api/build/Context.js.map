{"version":3,"sources":["../src/Context.js"],"names":["Context","constructor","request","db","DataLoader","keys","table","whereIn","select","then","x","id","validate","input","validator","Validator","errors","ValidationError","apply"],"mappings":";;;;;;;;;;;AAWA;;AAEA;AACA;AACA,kC;;AAEO,MAAMA,OAAN,CAAc;;;;AAInBC,EAAAA,WAAW,CAACC,OAAD,EAAmBC,EAAnB,EAA4B;;;;;AAK1B,QAAIC,mBAAJ,CAAe,CAAAC,IAAI;AAC9B,SAAKF,EAAL;AACGG,IAAAA,KADH,CACS,YADT;AAEGC,IAAAA,OAFH,CAEW,IAFX,EAEiBF,IAFjB;AAGGG,IAAAA,MAHH;AAIGC,IAAAA,IAJH,CAIQ,kBAAMJ,IAAN,EAAYK,CAAC,IAAIA,CAAC,CAACC,EAAnB,CAJR,CADW,CAL0B,EACrC,KAAKR,EAAL,GAAUA,EAAV,CACA,KAAKD,OAAL,GAAeA,OAAf,CACD;;;AAUD;;;;AAIAU,EAAAA,QAAQ,CAACC,KAAD,EAAa;AACnB,UAAMC,SAAS,GAAG,IAAIC,kBAAJ,CAAc,IAAd,EAAoBF,KAApB,EAA2BG,MAAM,IAAI;AACrD,YAAM,IAAIC,uBAAJ,CAAoBD,MAApB,CAAN;AACD,KAFiB,CAAlB;;AAIA,WAAQE,KAAD,IAAgB;AACrBA,MAAAA,KAAK,CAACJ,SAAD,CAAL;AACA,aAAOA,SAAS,CAACF,QAAV,EAAP;AACD,KAHD;AAID,GA9BkB,C;;;AAiCNZ,O","sourcesContent":["// @flow\n\n/**\n * Copyright ï¿½ 2016-present Kriasoft.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\n/* eslint-disable no-undef */ // TEMP\n\nimport DataLoader from 'dataloader';\nimport type { request as Request } from 'express';\nimport Validator from './Validator';\nimport { mapTo } from './schema/utils';\nimport { ValidationError } from './errors';\n\nexport class Context {\n  request: Request;\n  db: any;\n\n  constructor(request: Request, db: any) {\n    this.db = db;\n    this.request = request;\n  }\n\n  properties = new DataLoader(keys =>\n    this.db\n      .table('properties')\n      .whereIn('id', keys)\n      .select()\n      .then(mapTo(keys, x => x.id)),\n  );\n\n  /*\n   * Validation\n   */\n\n  validate(input: any) {\n    const validator = new Validator(this, input, errors => {\n      throw new ValidationError(errors);\n    });\n\n    return (apply: any) => {\n      apply(validator);\n      return validator.validate();\n    };\n  }\n}\n\nexport default Context;\n"]}